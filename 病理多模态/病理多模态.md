# 病理多模态

## 对比学习

### Deep learning supported discovery of biomarkers for clinical prognosis of  liver cancer

#### 简介

提出了一个可解释 DL 指导框架，称为 PathFinder

发现肝癌坏死的空间分布是一个长期被忽视的因素，与患者的预后有很强的关系。因此，我们提出了两个临床独立的指标，包括坏死面积分数和肿瘤坏死分布，用于实际预后，并根据肿瘤标志物预后研究的 R ep 或 ting R ec 推荐标准验证了它们在临床预后中的潜力。

一些研究验证了已建立的生物标志物和归因方法抽象风险评分的可信度，但是不能生成临床预后的新知识。

![image-20230610133327032](病理多模态.assets/image-20230610133327032.png)

#### 解决的问题

前者包含多类组织的空间分布和相互作用信息，后者包含细胞结构和结构信息(方法和扩展数据图1)。然而，受到图形处理单元存储器和深度神经网络架构的限制，WSI 通常被切割成补丁，并且在大多数基于 DL 的研究中只关注微模式信息。

#### 亮点

使用 WSI 的稀疏的多类组织空间分布信息来评估预后和发现新的生物标志物。利用 WSI 的宏观模式，即低信息密度，完全匹配目前的空间定位属性方法，PathFinder 可以实现最先进的预测性能。

- 提出了两个临床独立的指标

  - 坏死面积分数(NEC)

  - 肿瘤坏死分布(TND)

- 并验证了NEC 和 TND 是否是**独立**的预后指标
- 甚至可以用作**复发预测的显着指标**
- 探讨如何从患者的**多个 WSI 中选择具有代表性的 WSI**
- 克服基于 DL 的风险评分的可解释性和普遍性有限的问题
- 病理学家挖掘主要生物标志物的**新工具**

#### 数据

癌症基因组图谱肝脏肝细胞性肝癌数据集(TCGA 数据集)

- 330个患者样本中收集了342个 WSI

北京清华长庚医院数据集(QHCG 数据集)

- 83个患者样本中收集了1182个 WSI

对于患者有多个 WSI 的情况，我们选择**肿瘤分数最大**的一个作为患者的代表性 WSI

#### 工作流

![image-20230610143426666](病理多模态.assets/image-20230610143426666.png)

##### 宏观模式获取

训练多类组织分割网络 PaSegNet（cnn网络，获得七种常见肝组织的空间分布概率热图）

TUM, tumor; Nor, normal; FIB, fibrosis; INF, inflammation;  NEC, necrosis; REA, bile duct reaction; STE, steatosis; EMP, empty

提出了**元注释**，一种**以数据为中心的注释方法**，结合病理学先验，弥合目前病理学注释方法与 DL 训练需求之间的差距



##### 预测深度神经网络训练

所获得的宏观模式和相应的**生存时间**被用作图像标签对来**训练** MacroNet（cnn+BN+MLP，），**输出**相应的**风险评分**来指导患者的预后

在 TCGA 数据集上对 MacroNet 进行了十倍交叉验证的培训，并在 QHCG 数据集上测试了经过训练的模型的普适性。

为了更好地比较 MacroNet 的预后性能，我们还设计和训练了 MicroNet 和 M2MNet 用于预后任务。前者基于微观模式，以高分辨率肿瘤贴片为输入，后者基于宏观模式和微观模式，试图融合这两种模式**（这里有点反常理）**

##### 新的生物标志物发现

###### method

将**归因算法**应用于训练有素、性能良好的 MacroNet 模型，以探索模型的空间焦点区域，从中得到潜在的预后生物标志物的启示

随后，这些**假设的生物标志物**以宏观模式为基础建模，以实现量化和角色塑造化，其中类似于可视化后的归因图的标志物被选为候选生物标志物，并用作多变量分析的指标。经过临床数据集的检验，可以确定明显独立的预后指标。

在宏观模型和归因图的综合分析的基础上，**病理学家可以提出模型所涉及的生物标志物的假设**，然后是定量的角色塑造。新的生物标志物的可视化与相应的归因图相似，根据**肿瘤标志物预后研究报告建议**的标准，被用作多变量分析的指标。经过临床数据测试，新的生物标志物显着独立的预后效果被发现

###### result

![image-20230611135754019](病理多模态.assets/image-20230611135754019.png)

![image-20230611140008002](病理多模态.assets/image-20230611140008002.png)

发现高贡献区域几乎是**坏死和其他组织的连接处**(图3b) ，这与我们以前从**全局角度**得出的结论是一致的。（全局角度：）



因此提出了两个临床独立的指标

- 坏死面积分数(NEC)
- 肿瘤坏死分布(TND)

发现这两个假设的指标可以很好地表征 MacroNet 关注的特征(图3b 和扩展数据图8) ，表明这两个临床可用的指标具有很大的潜力来影响 MacroNet 给出的风险评分的预后。

还应该指出的是：

- 这些生物标志物是客观和普遍的病理学特征，考虑到 NEC 是 WSI 的共同和固有属性
- TND 是考虑到肿瘤和坏死之间的**空间分布和相互作用**的**新设计的指标**

![Extended Data Fig. 8](病理多模态.assets/42256_2023_635_Fig13_ESM.jpg)

![image-20230611135559900](病理多模态.assets/image-20230611135559900.png)

![image-20230611150527993](病理多模态.assets/image-20230611150527993.png)

为了验证 NEC 和 TND 是否是独立的预后指标，通过对临床病理参数进行单变量和多变量分析，使用 Kaplan-Meier 曲线和 Cox 风险分析来研究这两个指标在 TCGA 和 QHCG 数据集上的预后意义。

Kaplan-Meier 曲线和 P 值显示 NEC 和 TND 可以显着区分 TCGA 和 QHCG 数据集上的高风险和低风险组(图4a，c，e，g)。

<center class="half">
    <img src="病理多模态.assets/image-20230611150749074.png"/>
    <img src="病理多模态.assets/image-20230611150802881.png"/>
</center>



单因素和多变量分析显示，

总生存率依赖于：

NEC：

- QHCG 数据集

  - HR 4.66,95%
  - CI 1.77 ~ 12.28
  - P = 0.0019

- TCGA 数据集

  - HR 1.80,95%
  - CI 1.13 ~ 2.87
  - P = 0.0133

  

TND：

- QHCG 数据集

  - HR 6.67,95%
  - CI 2.36~18.85
  - P = 0.0003

- TCGA 数据集

  - HR 3.00,95%
  - CI 1.56~5.74
  - P = 0.0009

  

NEC和TND比大多数临床指标(包括 TIL)更为显著(图4b，d，f，h)。这表明，这两个指标是独立的其他临床病理特征。

<center class="half">
    <img src="病理多模态.assets/image-20230611151538463.png"/>
    <img src="病理多模态.assets/image-20230611151611114.png"/>
</center>





![image-20230611152051723](病理多模态.assets/image-20230611152051723.png)

![image-20230611152110315](病理多模态.assets/image-20230611152110315.png)

![image-20230611150544070](病理多模态.assets/image-20230611150544070.png)

将性能与已经被称为预后因素的肿瘤浸润淋巴细胞(TIL)进行比较

![image-20230611150030313](病理多模态.assets/image-20230611150030313.png)

![image-20230611150120517](病理多模态.assets/image-20230611150120517.png)

值得注意的是，Cox 比例风险模型能够在不使用额外的临床变量或 DL 方法预测的风险评分的情况下达到 C 指数0.7，因为它仅基于 NEC (C 指数0.703)或 TND (C 指数0.691)进行预测(图5d，e)。

![image-20230611154105366](病理多模态.assets/image-20230611154105366.png)

此外，综合考虑其他临床因素，NEC 和 TND 的 C 指数可进一步提高至0.831和0.845，表明这两个指标在临床预后中的价值(补充图5)。**（这里我不是很理解，不应该是排除NEC 和 TND后看效果吗？）**

![image-20230611154030348](病理多模态.assets/image-20230611154030348.png)

总的来说，上述结果证实了坏死的空间分布是预后的一个新的生物标志物。我们证明了基于 WSI 宏观模式的 AI 启发指标的预后性能与基于 WSI 微观模式、基因组学和多模态的各种 DL 模型的性能相当

![image-20230611154445239](病理多模态.assets/image-20230611154445239.png)

##### 验证模型鲁棒性

在临床实践中，通常有许多来自患者的采样位置不同的 WSI (图5a)。由于微观模式**不受**取样位置的很大影响，在微观模式上训练的预后 DL 模型**很少讨论患者具有多个 WSIs的情况**。

![image-20230611155224291](病理多模态.assets/image-20230611155224291.png)

NLP，非肿瘤性肝实质; TC，肿瘤中心; TI，肿瘤-肝界面; ANL，邻近非肿瘤性肝; RNL，远端非肿瘤性肝。



但不同的抽样位置将**导致宏观模式的巨大差异**，这将导致宏观网络预测的风险评分的偏差(图5b 和扩展数据图7e，f)。**探讨如何从患者的多个 WSI 中选择具有代表性的 WSI**，成为临床预后宏观指标应用中不可回避的问题

![image-20230611155755039](病理多模态.assets/image-20230611155755039.png)

![image-20230611155824999](病理多模态.assets/image-20230611155824999.png)

在我们以前的研究中，我们选择了**最大的肿瘤部分**作为患者的代表性 WSI。

为了探讨这种选择规则在临床预后中的稳健性和有效性，我们计算了所有 WSI 的风险评分，TND 和 NEC，并从患者的多个 WSI 中随机选择一个作为代表性 WSI，使用 C 指数来衡量预后的准确性在这个随机抽样标准下。

在随机选择策略下进行了10,000次模拟后，我们以前的选择规则的预后性能优于大多数随机选择(图5c，d，e)。

![image-20230611160513760](病理多模态.assets/image-20230611160513760.png)

即使对于 NEC 和 TND 这两种客观和通用的生物标志物，**基于最大肿瘤分数选择规则的结果优于94%基于随机选择规则的结果**（为什么没有图？），表明 NEC 和 TND 生物标志物可以采用最大肿瘤分数选择规则进行临床预后。

此外，验证由不同精度的分割图计算出的这两个指标的预测鲁棒性也很重要。我们首先计算了由11个常用的卷积神经网络(CNN)产生的分割图对应的 TND 和 NEC 评分(扩展数据图9和10,补充说明2及补充图6及7)。

![Extended Data Fig. 9](病理多模态.assets/42256_2023_635_Fig14_ESM.jpg)

![image-20230611161232902](病理多模态.assets/image-20230611161232902.png)

A，根据11个 CNN 产生的分割结果计算每个患者的 TND 评分。对应于 ResNeXt50(本研究中使用的 CNN)的 TND 评分用不透明的蓝色星号标记。患者根据对应于 ResNeXt50的 TND 评分进行排名。B，分类性能，分割结果，TND 热图，以及不同 CNN 的预后性能。直方图包括在 QHCG 测试集上测试的每个 CNN 的“肿瘤”类别的召回，精确度和 F1评分，以及基于每个 CNN 生成的分段图的 TND 预后表现(C-Index)。C，不同 CNN (n = 11个网络)的预测性能分布。箱形图晶须延伸到铰链四分位间距的1.5倍内的最小和最大值，箱形中心和铰链分别表示中位数和第一和第三四分位数。

![Extended Data Fig. 10](病理多模态.assets/42256_2023_635_Fig15_ESM.jpg)



然后我们测量相应的 NEC 和 TND 评分的预后表现(即 C 指数)。在由同一患者的不同 CNN 产生的分割结果计算的 TND 和 NEC 评分中没有发现重大差异，并且评分排名的总体趋势在所有患者中保持相对一致(扩展数据图9a 和10a)。更具体地说，**除了分类性能较差的 AlexNet 之外，从其他 CNN 生成的分段图获得的 TND 的 C 指数和NEC是接近的**。**这些结果说明了这两个指标对预后的稳健性**，进一步说明了它们在临床实践中的推广能力和可用性

#### 讨论

![image-20230611172857626](病理多模态.assets/image-20230611172857626.png)

不使用 DL 来预测 WSIs的风险评分，而是侧重于提出以人为中心的工作流程，以激励病理学家从表现良好的黑盒中发现新的临床上可接受的生物标志物

![image-20230611173008141](病理多模态.assets/image-20230611173008141.png)

探讨多类组织空间分布与预后之间的关系

输入更稀疏，具有明确的医学意义，这使得归因方法能够更准确地表征模型关注的生物标志物。

![image-20230611173139404](病理多模态.assets/image-20230611173139404.png)

结果表明，即使从几 GB 的 WSI 减少到几 MB 的宏模式，DL 的预测性能仍然很好。这表明 WSI 的多类组织空间分布具有预后信息，预后 DL 模型的**常规输入是多余的**。

![image-20230611173243241](病理多模态.assets/image-20230611173243241.png)



**准确的定位：**我们没有把 AI 作为病理学家的替代品，而是作为病理学家挖掘主要生物标志物的工具。

我们的研究结果表明，人工智能可以更客观地分析数据，并提醒我们的信息缺失。

同时，肿瘤与坏死之间的作用机制尚不清楚。TND 和 NEC 对预后的显著影响可能提示组织的空间分布是坏死机制研究中值得考虑的因素。此外，肿瘤坏死被认为是由**肿瘤坏死因子**引起的[35] ，这些因子**与 TILs有显着的相关性**。然而，我们的研究结果表明**肿瘤坏死与 TIL 之间的相关性较低**(扩展数据图6j，k) ，表明 HCC 坏死可能有其特定的原因和机制。

![image-20230611173750123](病理多模态.assets/image-20230611173750123.png)

![image-20230611173800433](病理多模态.assets/image-20230611173800433.png)

P 值根据two-sided log-rank test(a-f)和多变量 Cox 比例风险模型(g-i)。N，样本量; HR，风险比; 分期，AJCC 分期; TIL，肿瘤浸润性淋巴细胞数字评分; BDT，胆管血栓形成; AFP，α-胎儿蛋白; MVI，微血管浸润。

![image-20230611174128253](病理多模态.assets/image-20230611174128253.png)

一个总结

作为知识发现的产物，TND 和 NEC 具有明显的病理学意义和明确的数学模型。在 TCGA 和 QHCG 数据集上评估了这些新的生物标志物的强大的普遍性，表明以人为中心的 AI 在知识发现和临床预后方面具有巨大的优势。与所有常用的 DL 模型一样，PathFinder 的聚焦特性会受到训练数据和超参数的影响。此外，宏观模式的个体内部变异性也不容忽视。然而，我们探讨了宏模式的鲁棒性，并给出了一个可行的宏模式可变性问题的选择规则。在 PathFinder 中，宏模式可以像微模式一样实现最先进的预测性能。考虑到许多研究已经在各种癌症类型中实现了多类组织分割[38,39] ，进一步探索这些现成的分割图对预后的影响可能会导致新的发现。

![image-20230611174326254](病理多模态.assets/image-20230611174326254.png)

此外，得益于其简单易用的特征，PathFinder 可以**很容易地迁移到类似的任务，如空间多组学和三维病理预后**，以发现不同方式的新生物标志物。我们希望 PathFinder 作为一种基本机制，能够更好地整合临床预后和 AI 两个领域，并激发更多有意义的发现。



#### 为什么要做分割

为了更好的可视化？

#### 归因算法

![image-20230610165425510](病理多模态.assets/image-20230610165425510.png)

https://www.robots.ox.ac.uk/~vgg/publications/2014/Simonyan14a/poster.pdf

![image-20230610165737947](病理多模态.assets/image-20230610165737947.png)

#### 元注释

#### C-index

交叉验证一致性指数

#### Survival AUC

#### Kaplan-Meier 曲线

#### 对数秩检验

来测试高风险和低风险组之间的统计学差异

two-sided log-rank test